// ===== DATA WISATA (global window.wisata) =====
window.wisata = [
  { id: 1, nama: "Gunung Bromo", kategori: "Gunung", lokasi: "Probolinggo", harga: "25.000", img: "bromo.jpg",
    deskripsi: "Gunung Bromo terkenal dengan pemandangan matahari terbit dan lautan pasirnya.", jam: "04:00 - 18:00",
    fasilitas: "Parkir, Toilet, Warung, Jeep", maps: "https://maps.google.com/?q=Gunung+Bromo" },

  { id: 2, nama: "Pantai Klayar", kategori: "Pantai", lokasi: "Pacitan", harga: "10.000", img: "klayar.jpg",
    deskripsi: "Pantai dengan formasi batuan indah dan ombak tenang.", jam: "06:00 - 18:00",
    fasilitas: "Parkir, Warung, Spot Foto", maps: "https://maps.google.com/?q=Pantai+Klayar" },

  { id: 3, nama: "Museum Angkut", kategori: "Edukasi", lokasi: "Batu", harga: "100.000", img: "museum.jpg",
    deskripsi: "Museum transportasi terbesar di Indonesia dengan koleksi menarik.", jam: "09:00 - 17:00",
    fasilitas: "Parkir, Cafe, Guided Tour", maps: "https://maps.google.com/?q=Museum+Angkut" },

  { id: 4, nama: "Hutan De Djawatan", kategori: "Alam", lokasi: "Banyuwangi", harga: "Free", img: "hutan.jpg",
    deskripsi: "Hutan jati terkenal dengan pohon besar berderet rapi, suasana magis.", jam: "07:00 - 17:00",
    fasilitas: "Parkir, Spot Foto", maps: "https://maps.google.com/?q=Hutan+De+Djawatan" },

  { id: 5, nama: "Telaga Sarangan", kategori: "Danau", lokasi: "Magetan", harga: "20.000", img: "sarangan.jpg",
    deskripsi: "Danau pegunungan tenang, cocok untuk keluarga dan perahu.", jam: "06:00 - 18:00",
    fasilitas: "Perahu, Parkir, Penginapan", maps: "https://maps.google.com/?q=Telaga+Sarangan" },

  { id: 6, nama: "Gunung Arjuno", kategori: "Gunung", lokasi: "Malang - Pasuruan", harga: "29.000", img: "arjuno.jpg",
    deskripsi: "Gunung populer untuk pendakian dengan rute klasik Arjuno-Welirang.", jam: "24 jam",
    fasilitas: "Basecamp, Parkir", maps: "https://maps.google.com/?q=Gunung+Arjuno" },

  { id: 7, nama: "Gunung Welirang", kategori: "Gunung", lokasi: "Mojokerto", harga: "25.000", img: "weli.jpg",
    deskripsi: "Gunung bersebelahan dengan Arjuno, menawarkan pemandangan kawah.", jam: "24 jam",
    fasilitas: "Basecamp, Parkir", maps: "https://maps.google.com/?q=Gunung+Welirang" },

  { id: 8, nama: "Gunung Semeru", kategori: "Gunung", lokasi: "Lumajang", harga: "22.000", img: "semeru.jpg",
    deskripsi: "Gunung tertinggi di Jawa, populer untuk pendaki berpengalaman.", jam: "24 jam",
    fasilitas: "Basecamp, Guide", maps: "https://maps.google.com/?q=Gunung+Semeru" },

  { id: 9, nama: "Gunung Raung", kategori: "Gunung", lokasi: "Banyuwangi", harga: "20.000", img: "raung.jpg",
    deskripsi: "Gunung gunung vulkanik dengan medan menantang.", jam: "24 jam",
    fasilitas: "Basecamp, Parkir", maps: "https://maps.google.com/?q=Gunung+Raung" },

  { id: 10, nama: "Kawah Ijen", kategori: "Gunung", lokasi: "Banyuwangi", harga: "100.000", img: "kawah.jpg",
    deskripsi: "Dikenal dengan blue fire (api biru) dan danau belerang biru kehijauan.", jam: "01:00 - 17:00",
    fasilitas: "Guide, Parkir, Penginapan", maps: "https://maps.google.com/?q=Kawah+Ijen" },

  { id: 11, nama: "Pantai Tiga Warna", kategori: "Pantai", lokasi: "Malang", harga: "10.000", img: "3.jpg",
    deskripsi: "Pantai dengan tiga gradasi warna laut yang menawan.", jam: "06:00 - 16:00",
    fasilitas: "Parkir, Camping, Spot Snorkeling", maps: "https://maps.google.com/?q=Pantai+Tiga+Warna" },

  { id: 12, nama: "Pantai Balekambang", kategori: "Pantai", lokasi: "Malang", harga: "15.000", img: "bale.png",
    deskripsi: "Pantai dengan pulau kecil dan pura di tepi.", jam: "06:00 - 18:00",
    fasilitas: "Parkir, Warung", maps: "https://maps.google.com/?q=Pantai+Balekambang" },

  { id: 13, nama: "Pulau Sempu", kategori: "Pantai", lokasi: "Malang", harga: "20.000", img: "OIP (1).jpg",
    deskripsi: "Pulau eksotis dengan laguna alami (reservasi & ijin diperlukan).", jam: "06:00 - 16:00",
    fasilitas: "Guide, Camping", maps: "https://maps.google.com/?q=Pulau+Sempu" },

  { id: 14, nama: "Pantai Watu Ulo", kategori: "Pantai", lokasi: "Jember", harga: "7.000", img: "watu.jpg",
    deskripsi: "Pantai dengan batu-batu panjang dan panorama sunset.", jam: "06:00 - 18:00",
    fasilitas: "Parkir, Warung", maps: "https://maps.google.com/?q=Pantai+Watu+Ulo" },

  { id: 15, nama: "Pantai Pulau Merah", kategori: "Pantai", lokasi: "Banyuwangi", harga: "10.000", img: "red.jpg",
    deskripsi: "Pantai dengan pulau karang merah dan ombak yang cocok untuk surfing.", jam: "06:00 - 18:00",
    fasilitas: "Parkir, Penginapan, Surf", maps: "https://maps.google.com/?q=Pantai+Pulau+Merah" },

  { id: 16, nama: "Pantai Plengkung (G-Land)", kategori: "Pantai", lokasi: "Banyuwangi", harga: "25.000", img: "OIP.jpg",
    deskripsi: "Salah satu spot surfing terbaik di dunia (G-Land).", jam: "06:00 - 18:00",
    fasilitas: "Camping, Guide, Surf", maps: "https://maps.google.com/?q=Pantai+Plengkung" }
];

// ===== FAVORITES (localStorage) =====
let favorites = JSON.parse(localStorage.getItem("ln_favorites") || "[]");
function saveFavorites() {
  localStorage.setItem("ln_favorites", JSON.stringify(favorites));
}

// ===== SELECT ELEMENTS =====
const container = document.getElementById("cards");
const searchInput = document.getElementById("q");
const favoriteBtn = document.getElementById("viewSavedBtn");
const favoritePanel = document.getElementById("favPanel");
const favoriteList = document.getElementById("favList");
const closeFav = document.getElementById("closeFav");
const clearFav = document.getElementById("clearFav");

// ===== RENDER =====
function renderWisata() {
  if (!container) return;
  container.innerHTML = "";

  const q = (searchValue || "").toLowerCase();

  let filtered = window.wisata.filter(item =>
    item.nama.toLowerCase().includes(q) || item.lokasi.toLowerCase().includes(q)
  );

  filtered.forEach(item => {
    const card = document.createElement("div");
    card.className = "card";

    const isFav = favorites.includes(item.id);

    card.innerHTML = `
      <div class="thumb" style="background-image:url('${item.img}')"></div>
      <div class="title">${item.nama}</div>
      <div class="meta">${item.lokasi} • ${item.kategori}</div>
      <div class="actions" style="display:flex; gap:8px; margin-top:10px;">
        <button class="btn small secondary" onclick="goDetail(${item.id})">Detail</button>
        <button class="btn small secondary" onclick="toggleFavorite(${item.id})">
          ${isFav ? "Hapus Favorit" : "Simpan Favorit"}
        </button>
      </div>
    `;

    container.appendChild(card);
  });
}

// expose render to global for detail page reliance (not strictly necessary)
window.renderWisata = renderWisata;

// ===== SEARCH HANDLER =====
let searchValue = "";
if (searchInput) {
  searchInput.addEventListener("input", e => {
    searchValue = e.target.value;
    renderWisata();
  });
}

// ===== FAVORIT =====
function toggleFavorite(id) {
  if (favorites.includes(id)) {
    favorites = favorites.filter(f => f !== id);
  } else {
    favorites.push(id);
  }
  saveFavorites();
  renderWisata();
  renderFavoriteList();
}
window.toggleFavorite = toggleFavorite; // expose for detail page

function renderFavoriteList() {
  if (!favoriteList) return;
  favoriteList.innerHTML = "";

  if (favorites.length === 0) {
    favoriteList.innerHTML = `<p class="meta" style="text-align:center; opacity:.7">Belum ada favorit.</p>`;
    return;
  }

  favorites.forEach(fid => {
    const item = window.wisata.find(w => w.id === fid);
    if (!item) return;

    const el = document.createElement("div");
    el.className = "fav-item";
    el.style.padding = "14px";
    el.style.fontSize = "15px";
    el.innerHTML = `
      <div class="fav-item-title" style="font-size:17px;font-weight:600;margin-bottom:6px;">${item.nama}</div>
      <div class="meta">${item.lokasi} • ${item.kategori}</div>
      <div style="margin-top:8px;display:flex;gap:8px;">
        <button class="btn small secondary" onclick="goDetail(${item.id}); closeFavPanel();">Lihat</button>
        <button class="btn small secondary" onclick="toggleFavorite(${item.id})">Hapus</button>
      </div>
    `;
    favoriteList.appendChild(el);
  });
}

// ===== FAVORITE PANEL HANDLERS =====
function openFavPanel() {
  if (!favoritePanel) return;
  favoritePanel.style.display = "flex";
  favoritePanel.setAttribute("aria-hidden","false");
  renderFavoriteList();
}
function closeFavPanel() {
  if (!favoritePanel) return;
  favoritePanel.style.display = "none";
  favoritePanel.setAttribute("aria-hidden","true");
}

if (favoriteBtn) favoriteBtn.onclick = openFavPanel;
if (closeFav) closeFav.onclick = closeFavPanel;
if (clearFav) clearFav.onclick = () => {
  if (confirm("Hapus semua favorit?")) {
    favorites = [];
    saveFavorites();
    renderFavoriteList();
    renderWisata();
  }
}

// ===== NAVIGASI KE HALAMAN DETAIL =====
function goDetail(id) {
  // buka detail.html dan replace history supaya halaman sebelumnya tidak mudah kembali (optional)
  // menggunakan location.assign akan tetap menambahkan history; gunakan location.replace untuk mengganti stack.
  // Karena kamu ingin "halaman sebelumnya tidak kelihatan lagi", pakai replace.
  window.location.replace(`detail.html?id=${id}`);
}
window.goDetail = goDetail;

// ===== INIT =====
renderWisata();
renderFavoriteList();
